<div class="doctor-layout">
    <aside class="sidebar">
        <div class="sidebar-header">
            <div class="portal-icon">
                <i class="pi pi-heart-fill"></i>
            </div>
            <h2>Dr. Portal</h2>
        </div>

        <nav class="sidebar-nav">
            <button class="nav-item active">
                <i class="pi pi-th-large"></i>
                My Dashboard
            </button>
        </nav>

        <div class="sidebar-footer">
            <button class="sign-out-btn" (click)="logout()">
                <i class="pi pi-sign-out"></i>
                Sign Out
            </button>
        </div>
    </aside>

    <!-- main page -->
    <main class="main-content">
        <p-toast></p-toast>

        <header class="top-header">
            <div class="doctor-info">
                <h1>{{ doctorName }}</h1>
                <p>{{ specialty }} • {{ room }}</p>
            </div>
            <div class="active-session">
                <i class="pi pi-check-circle"></i>
                Active Session
            </div>
        </header>

        <section class="stats-section">
            <div class="stat-card">
                <div class="stat-item">
                    <div class="stat-icon waiting">
                        <i class="pi pi-user"></i>
                    </div>
                    <div class="stat-text">
                        <div class="stat-number">{{ waitingPatients }}</div>
                        <div class="stat-label">Waiting in Queue</div>
                    </div>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-item">
                    <div class="stat-icon served">
                        <i class="pi pi-user-plus"></i>
                    </div>
                    <div class="stat-text">
                        <div class="stat-number">{{ patientsServed }}</div>
                        <div class="stat-label">Patients Served</div>
                    </div>
                </div>
            </div>
        </section>

        <div class="content-grid">
            <!-- current consulation -->
            <section class="consultation-section">
                <div class="section-header">
                    <h2>CURRENT CONSULTATION</h2>
                    <span class="in-progress-badge" *ngIf="currentPatient">IN PROGRESS</span>
                </div>

                <ng-container *ngIf="currentPatient; else noPatient">
                    <div class="consultation-card">
                        <!-- Patient Header -->
                        <div class="patient-header">
                            <div>
                                <h3>{{ currentPatient.name }}</h3>
                                <p>{{ currentPatient.age }}y • {{ currentPatient.gender }}</p>
                            </div>
                            <div class="token-display">{{ currentPatient.token }}</div>
                        </div>

                        <!-- Patient Details -->
                        <div class="patient-details">
                            <div class="detail-item">
                                <span class="detail-label">Reason:</span>
                                <span class="detail-value">{{ currentPatient.reason }}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Phone:</span>
                                <span class="detail-value">{{ currentPatient.phone }}</span>
                            </div>
                        </div>

                        <div class="prev-history-wrapper">
                            <button class="prev-history-link" (click)="viewPreviousHistory()">
                                <i class="pi pi-history"></i>
                                View Previous History
                            </button>
                        </div>
                        <!-- it must be visible only when consulation has started-->
                        <div class="notes-section" *ngIf="isConsultationActive">
                            <label class="notes-label">Consultation Notes (Optional)</label>
                            <textarea pInputTextarea [(ngModel)]="consultationNotes" rows="6"
                                placeholder="Type clinical notes, diagnosis, or prescriptions here..."
                                class="notes-textarea"></textarea>
                        </div>

                        <div class="consultation-actions">
                            <!-- Start Consultation -->
                            <ng-container *ngIf="!isConsultationActive">
                                <button pButton label="Start Consultation" icon="pi pi-play" class="start-btn"
                                    (click)="startConsultation()"></button>
                            </ng-container>

                            <!-- Finish Consultation -->
                            <ng-container *ngIf="isConsultationActive">
                                <button pButton label="Finish Consultation" icon="pi pi-check" class="finish-btn"
                                    (click)="finishConsultation()"></button>
                            </ng-container>

                            <button pButton label="Skip Patient" icon="pi pi-forward" class="skip-btn"
                                (click)="skipPatient()"></button>
                        </div>
                    </div>
                </ng-container>

                <ng-template #noPatient>
                    <div class="consultation-card empty">
                        <div class="patient-header">
                            <div>
                                <h3>No active consultation</h3>
                                <p class="subtitle">Waiting for next patient</p>
                            </div>
                        </div>
                    </div>
                </ng-template>
            </section>

            <!-- UPCOMING PATIENTS -->
            <aside class="upcoming-section">
                <div class="section-header">
                    <h3>Upcoming Patients</h3>
                    <span class="count">{{ upcomingPatients.length }}</span>
                </div>

                <div class="upcoming-list">
                    <div *ngFor="let patient of upcomingPatients" class="upcoming-card">
                        <div class="patient-token">{{ patient.token }}</div>
                        <div class="patient-info">
                            <h4>{{ patient.name }}</h4>
                            <p>{{ patient.age }} • {{ patient.reason }}</p>
                        </div>
                        <div class="wait-time">
                            <i class="pi pi-clock"></i>
                            {{ patient.waitTime }}
                        </div>
                    </div>
                </div>

                <!-- SKIPPED QUEUE -->
                <div class="section-header" style="margin-top: 1rem;">
                    <h3>Skipped Patients</h3>
                    <span class="count">{{ skippedPatients.length }}</span>
                </div>
                <div class="skipped-list">
                    <div *ngIf="skippedPatients.length === 0" class="queue-empty">No skipped patients</div>
                    <div *ngFor="let s of skippedPatients; let si = index" class="skipped-card">
                        <div class="skipped-info">
                            <div class="skipped-token">{{ s.token }}</div>
                            <div class="skipped-name">{{ s.name }}</div>
                        </div>
                        <button pButton class="readd-btn" label="+ Re-add" (click)="reAddFromSkipped(si)"></button>
                    </div>
                </div>
            </aside>
        </div>
    </main>
</div>